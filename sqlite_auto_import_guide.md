# SQLite自动导入功能使用指南

## 🎯 功能概述

新增的SQLite自动导入功能允许你将处理好的账号数据自动逐个导入到SQLite数据库中，避免手动复制粘贴SQL命令可能出现的错误。

## ✨ 功能特点

- **逐个导入**: 一个一个地导入账号，避免批量操作的风险
- **实时进度**: 显示导入进度和每个账号的处理状态
- **错误处理**: 详细的错误信息，跳过失败的账号继续处理
- **重复检查**: 自动检查邮箱是否已存在，避免重复导入
- **数据库验证**: 导入前测试数据库连接和表结构

## 📋 使用步骤

### 1. 准备账号数据
首先需要通过以下方式之一准备账号数据：
- **手动输入**: 填写表单字段
- **JSON导入**: 批量导入JSON格式的账号信息
- **处理账号**: 点击"🚀 开始处理"获取完整的token信息

### 2. 配置数据库路径
在"🗄️ 自动导入到SQLite数据库"区域：
- 输入数据库文件路径（默认：`account-pool-service/accounts.db`）
- 点击"🔍 测试连接"验证数据库是否可用

### 3. 执行自动导入
- 点击"📥 自动导入数据库"开始导入
- 观察实时进度和每个账号的处理状态
- 等待导入完成

## 🔧 数据库要求

### 表结构
数据库必须包含 `accounts` 表，包含以下字段：
```sql
CREATE TABLE accounts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    email TEXT UNIQUE NOT NULL,
    local_id TEXT NOT NULL,
    id_token TEXT NOT NULL,
    refresh_token TEXT NOT NULL,
    status TEXT DEFAULT 'available',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 支持的数据库路径格式
- 相对路径: `account-pool-service/accounts.db`
- 绝对路径: `/path/to/database/accounts.db`
- 当前目录: `./accounts.db`

## 📊 导入过程

### 实时显示信息
1. **进度条**: 显示整体导入进度
2. **状态信息**: 每个账号的处理状态
3. **成功统计**: 成功/失败的账号数量
4. **错误详情**: 失败账号的具体错误信息

### 导入逻辑
```
开始导入 → 逐个处理账号 → 检查邮箱重复 → 插入数据库 → 更新进度 → 显示结果
```

## 🚨 错误处理

### 常见错误及解决方案

1. **数据库文件不存在**
   - 错误: `数据库文件不存在: xxx.db`
   - 解决: 检查路径是否正确，确保数据库文件存在

2. **accounts表不存在**
   - 错误: `accounts表不存在`
   - 解决: 创建正确的表结构

3. **邮箱已存在**
   - 错误: `邮箱已存在`
   - 解决: 这是正常的重复检查，会跳过该账号

4. **数据完整性错误**
   - 错误: `数据完整性错误: xxx`
   - 解决: 检查数据格式是否正确

## 💡 使用技巧

### 1. 批量导入最佳实践
```
1. 先用少量账号测试
2. 确认数据库连接正常
3. 分批处理大量账号
4. 定期备份数据库
```

### 2. 错误恢复
- 导入失败的账号会显示具体错误
- 可以修复问题后重新导入失败的账号
- 成功导入的账号不会重复处理

### 3. 性能优化
- 每个账号导入间隔500ms，避免数据库压力
- 大量账号建议分批处理
- 导入过程中避免其他数据库操作

## 🔍 测试功能

### 数据库连接测试
点击"🔍 测试连接"会检查：
- 数据库文件是否存在
- 是否可以连接数据库
- accounts表是否存在
- 表结构信息

### 测试结果示例
```
✅ 数据库连接成功
表结构: 包含字段: id, email, local_id, id_token, refresh_token, status, created_at
```

## 📝 完整工作流程示例

1. **准备数据**:
   ```
   添加账号 → JSON导入 → 开始处理 → 获取tokens
   ```

2. **配置数据库**:
   ```
   输入路径: account-pool-service/accounts.db
   测试连接: ✅ 连接成功
   ```

3. **执行导入**:
   ```
   点击导入 → 显示进度 → 逐个处理 → 完成统计
   ```

4. **查看结果**:
   ```
   🎉 导入完成！
   ✅ 成功: 5/5
   ```

## ⚠️ 注意事项

1. **数据安全**: 导入前建议备份数据库
2. **权限检查**: 确保有数据库文件的读写权限
3. **并发控制**: 导入期间避免其他程序操作同一数据库
4. **网络稳定**: 确保服务器网络连接稳定

## 🔧 故障排除

### 导入按钮无响应
- 检查是否有处理好的账号数据
- 确认数据库路径已填写
- 查看浏览器控制台错误信息

### 导入速度慢
- 正常现象，每个账号间隔500ms
- 大量账号建议分批处理
- 检查服务器性能和数据库响应速度

### 部分账号导入失败
- 查看详细错误信息
- 修复数据问题后重新导入
- 检查数据库约束条件

这个功能大大简化了账号数据的管理流程，让你可以安全、可靠地将账号数据导入到数据库中！
